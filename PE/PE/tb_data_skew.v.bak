`timescale 1ns / 1ps

module tb_data_skew;

    // --- 1. Khai báo tín hiệu ---
    reg clk;
    reg rst;
    reg [63:0] ifmap_in;       // Input gộp 4 dòng (64 bit)
    wire [63:0] ifmap_skewed;  // Output đã lệch (64 bit)

    // Tách output ra từng dòng 16-bit để dễ debug trên Waveform
    wire [15:0] out_row0 = ifmap_skewed[15:0];
    wire [15:0] out_row1 = ifmap_skewed[31:16];
    wire [15:0] out_row2 = ifmap_skewed[47:32];
    wire [15:0] out_row3 = ifmap_skewed[63:48];

    // --- 2. Kết nối DUT (Device Under Test) ---
    Data_Skew_Buffer uut (
        .clk(clk),
        .rst(rst),
        .ifmap_in(ifmap_in),
        .ifmap_skewed(ifmap_skewed)
    );

    // --- 3. Tạo xung Clock 100MHz ---
    initial begin
        clk = 0;
        forever #5 clk = ~clk; // Chu kỳ 10ns
    end

    // --- 4. Task hỗ trợ nạp dữ liệu nhanh ---
    // Giúp code gọn hơn: Nạp 4 giá trị cho 4 hàng cùng lúc
    task drive_data(input [15:0] r3, input [15:0] r2, input [15:0] r1, input [15:0] r0);
        begin
            // Lưu ý thứ tự ghép bit: {Hàng 3, Hàng 2, Hàng 1, Hàng 0}
            ifmap_in = {r3, r2, r1, r0}; 
            @(posedge clk); #1; // Chờ clock đánh và giữ 1 chút
        end
    endtask

    // --- 5. Chương trình Test Chính ---
    initial begin
        // A. Khởi tạo
        rst = 1;
        ifmap_in = 0;
        
        // Reset hệ thống
        #20; 
        rst = 0; 
        $display("--- SIMULATION START ---");
        $display("Time | Row0(NoDelay) | Row1(Delay1) | Row2(Delay2) | Row3(Delay3)");

        // B. Kịch bản Test: Nạp "Ma trận đơn vị" để dễ nhìn
        // Tại cùng 1 thời điểm, ta nạp dữ liệu khác nhau vào 4 hàng
        // Input: 
        // Hàng 0: 1111
        // Hàng 1: 2222
        // Hàng 2: 3333
        //